<!-- Staff Members List View -->
<ng-container *ngIf="isBrowser && !showTasksView">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Staff del Departamento: {{ departmentName }}</h4>
    <button class="btn btn-outline-secondary" (click)="goBack()">
      <i class="fas fa-arrow-left me-2"></i>Volver
    </button>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
  </div>

  <div class="mt-3 mb-2">
    <input
      type="search"
      class="form-control input-soft"
      placeholder="Buscar miembros del staffâ€¦"
      [value]="search"
      (input)="onSearch($any($event.target).value)"
    />
  </div>

  <div class="staff-grid-wrap">
    <div *ngIf="loading" class="text-center p-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2">Cargando personal...</p>
    </div>

    <ag-grid-angular
      *ngIf="!loading"
      [theme]="gridTheme"
      [gridOptions]="gridOptions"
      [rowData]="rowData"
      [pagination]="true"
      style="width: 100%; height: 400px"
    >
    </ag-grid-angular>

    <div *ngIf="!loading && rowData.length === 0" class="text-center p-4">
      <p class="text-muted">No se encontraron miembros de staff para este departamento.</p>
    </div>
  </div>
</ng-container>

<!-- Tasks View -->
<div *ngIf="showTasksView && selectedStaffMember">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">
      <i class="fas fa-tasks me-2"></i>
      Tareas de {{ selectedStaffMember.user?.full_name || selectedStaffMember.name }}
      <small class="text-muted">(Staff ID: {{ selectedStaffMember.staff_id }})</small>
    </h4>
    <button class="btn btn-outline-secondary" (click)="backToStaffList()">
      <i class="fas fa-arrow-left me-2"></i>Volver al Staff
    </button>
  </div>

  <app-task-list
    [staffId]="selectedStaffMember.staff_id"
    (backToParent)="backToStaffList()"
  ></app-task-list>
</div>
