<!-- Cards KPI -->
<div class="row g-3">
  <!-- Card: Ingresos -->
  <div class="col-md-3">
    <div class="card-elev p-3 h-100">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Ingresos</div>

          <div class="fs-4 fw-bold">
            <ng-container *ngIf="!incomeLoading; else loadingIngresos">
              {{ incomeValue }}
            </ng-container>
            <ng-template #loadingIngresos>Calculando…</ng-template>
          </div>

          <div
            class="small"
            [class.text-success]="incomeDelta >= 0"
            [class.text-danger]="incomeDelta < 0"
          >
            <i
              class="bi"
              [ngClass]="{
                'bi-arrow-up-right': incomeDelta >= 0,
                'bi-arrow-down-right': incomeDelta < 0
              }"
            ></i>
            {{ incomeDelta | number : '1.0-1' }}%
          </div>
        </div>
        <i class="bi fs-2 bi-currency-dollar text-info"></i>
      </div>
    </div>
  </div>

  <!-- Card: Reservas (coloca tu lógica propia aquí) -->
  <div class="col-md-3">
    <div class="card-elev p-3 h-100">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Reservas</div>
          <div class="fs-4 fw-bold">{{ reservationValue }}</div>
          <div
            class="small"
            [class.text-success]="reservationDelta >= 0"
            [class.text-danger]="reservationDelta < 0"
          >
            <i
              class="bi"
              [ngClass]="{
                'bi-arrow-up-right': reservationDelta >= 0,
                'bi-arrow-down-right': reservationDelta < 0
              }"
            ></i>
            {{ reservationDelta | number : '1.0-1' }}%
          </div>
        </div>
        <i class="bi fs-2 bi-bag-check text-warning"></i>
      </div>
    </div>
  </div>

  <!-- Card: Visitantes (lógica propia) -->
  <div class="col-md-3">
    <div class="card-elev p-3 h-100">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Visitantes</div>
          <div class="fs-4 fw-bold">{{ usersValue }}</div>
          <div
            class="small"
            [class.text-success]="usersValue >= 0"
            [class.text-danger]="usersDelta < 0"
          >
            <i
              class="bi"
              [ngClass]="{
                'bi-arrow-up-right': usersDelta >= 0,
                'bi-arrow-down-right': usersDelta < 0
              }"
            ></i>
            {{ usersDelta | number : '1.0-1' }}%
          </div>
        </div>
        <i class="bi fs-2 bi-people text-primary"></i>
      </div>
    </div>
  </div>

  <!-- Card: Ocupación -->
  <div class="col-md-3">
    <div class="card-elev p-3 h-100">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="text-secondary small">Habitaciones Ocupadas</div>
          <div class="fs-4 fw-bold">{{ hotels.length * 20 }}</div>
          <div class="small text-info">
            <i class="bi bi-door-open"></i>
            Total disponible
          </div>
        </div>
        <i class="bi fs-2 bi-building text-success"></i>
      </div>
    </div>
  </div>
</div>

<!-- Chart + resumen -->
<div class="row g-3 mt-1">
  <!-- Gráfico: Reservas por tipo -->
  <div class="col-lg-6 col-md-12">
    <div class="card-elev p-3 h-100">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="fw-semibold">Reservas por tipo de habitación</div>
        <div class="small text-secondary">Este mes</div>
      </div>

      <!-- Loading state -->
      <div
        *ngIf="!chartDataLoaded"
        class="d-flex align-items-center justify-content-center"
        style="height: 300px"
      >
        <div class="spinner-border text-olive" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>

      <!-- Chart -->
      <apx-chart
        *ngIf="chartDataLoaded && isBrowser"
        #chart
        [series]="chartOptions.series"
        [chart]="chartOptions.chart"
        [xaxis]="chartOptions.xaxis"
        [dataLabels]="chartOptions.dataLabels"
        [stroke]="chartOptions.stroke"
        [grid]="chartOptions.grid"
        [legend]="chartOptions.legend"
        [fill]="chartOptions.fill"
        [colors]="chartOptions.colors || []"
      ></apx-chart>
    </div>
  </div>

  <!-- Gráfico: Amenities por hotel -->
  <div class="col-lg-6 col-md-12">
    <div class="card-elev p-3 h-100">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="fw-semibold">Amenities por hotel</div>
        <div class="small text-secondary">Totales</div>
      </div>

      <!-- Loading state -->
      <div
        *ngIf="!amenitiesChartLoaded"
        class="d-flex align-items-center justify-content-center"
        style="height: 300px"
      >
        <div class="spinner-border text-olive" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>

      <!-- Chart -->
      <apx-chart
        *ngIf="amenitiesChartLoaded && isBrowser"
        [series]="amenitiesChart.series"
        [chart]="amenitiesChart.chart"
        [xaxis]="amenitiesChart.xaxis"
        [dataLabels]="amenitiesChart.dataLabels"
        [stroke]="amenitiesChart.stroke"
        [grid]="amenitiesChart.grid"
        [legend]="amenitiesChart.legend"
        [fill]="amenitiesChart.fill"
        [colors]="amenitiesChart.colors || []"
      ></apx-chart>
    </div>
  </div>
</div>

<!-- Tabla -->
<div class="card-elev p-3 mt-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0">Hoteles recientes</h5>
    <a routerLink="/admin/hotels" class="btn btn-sm btn-olive">Ver todos</a>
  </div>

  <!-- Loading state -->
  <div *ngIf="hotelsLoading" class="d-flex align-items-center justify-content-center py-5">
    <div class="spinner-border text-olive" role="status">
      <span class="visually-hidden">Cargando hoteles...</span>
    </div>
  </div>

  <!-- Grid -->
  <ag-grid-angular
    *ngIf="!hotelsLoading && isBrowser"
    class="ag-theme-quartz soft-grid"
    style="width: 100%; height: 360px"
    [rowData]="hotels"
    [columnDefs]="colDefs"
    [rowHeight]="46"
  >
  </ag-grid-angular>

  <!-- Empty state -->
  <div *ngIf="!hotelsLoading && hotels.length === 0" class="text-center py-5 text-secondary">
    <i class="bi bi-building display-4 mb-3"></i>
    <p>No hay hoteles registrados</p>
  </div>
</div>
